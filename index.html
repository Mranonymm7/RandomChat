<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatle</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #000000);
            --tg-secondary: var(--tg-theme-secondary-bg-color, #111111);
            --tg-text: var(--tg-theme-text-color, #ffffff);
            --tg-hint: var(--tg-theme-hint-color, #999999);
            --tg-link: var(--tg-theme-link-color, #00aaff);
            --tg-button: var(--tg-theme-button-color, #0088cc);
            --tg-button-text: var(--tg-theme-button-text-color, #ffffff);
        }

        * { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 0;
            background: var(--tg-bg);
            color: var(--tg-text);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 420px;
            padding: 32px 24px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            font-size: 52px;
            font-weight: 900;
            background: linear-gradient(135deg, #00d4ff, #3366ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 8px;
            letter-spacing: -2px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .logo-emoji {
            font-size: 64px;
            filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.6));
        }

        .subtitle {
            font-size: 17px;
            opacity: 0.8;
            margin: 0;
            font-weight: 500;
        }

        .profile-card {
            background: var(--tg-secondary);
            border-radius: 28px;
            padding: 28px 24px;
            text-align: center;
            margin-bottom: 36px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
        }

        .avatar {
            width: 104px;
            height: 104px;
            border-radius: 50%;
            border: 5px solid var(--tg-button);
            box-shadow: 0 0 40px rgba(0, 136, 204, 0.5);
            margin-bottom: 20px;
        }

        .greeting {
            font-size: 26px;
            font-weight: 700;
            margin: 0 0 8px;
        }

        .info {
            font-size: 16px;
            opacity: 0.7;
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-size: 15px;
            font-weight: 500;
            opacity: 0.85;
        }

        input, select, textarea {
            width: 100%;
            padding: 17px 18px;
            background: rgba(255, 255, 255, 0.07);
            border: 1.5px solid rgba(255, 255, 255, 0.12);
            border-radius: 18px;
            color: var(--tg-text);
            font-size: 17px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        input::placeholder, textarea::placeholder {
            color: var(--tg-hint);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--tg-button);
            box-shadow: 0 0 0 4px rgba(0, 136, 204, 0.25);
        }

        textarea {
            min-height: 110px;
            resize: none;
        }

        .country-input {
            position: relative;
        }

        #country-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--tg-secondary);
            border: 1.5px solid rgba(255, 255, 255, 0.12);
            border-radius: 18px;
            max-height: 320px;
            overflow-y: auto;
            z-index: 10;
            margin-top: 8px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .country-item {
            padding: 16px 18px;
            cursor: pointer;
            transition: background 0.25s;
            font-size: 17px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .country-item:last-child {
            border-bottom: none;
        }

        .country-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .required {
            color: #ff4444;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container" id="app"></div>

    <script>
        if (!window.Telegram?.WebApp) {
            document.body.innerHTML = `<div style="text-align:center;padding:80px;color:#ff4444;"><h1>Access Denied</h1><p>Open from Telegram</p></div>`;
            throw new Error("Not in Telegram");
        }

        Telegram.WebApp.ready();
        Telegram.WebApp.expand();

        const tg = Telegram.WebApp;
        const user = tg.initDataUnsafe.user;

        const displayName = user.username ? `@\( {user.username}` : user.first_name + (user.last_name ? ` \){user.last_name}` : '');
        const photoUrl = user.photo_url || 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f60a.png';

        const countries = [{"name":"Afghanistan","flag":"ðŸ‡¦ðŸ‡«","code":"AF"},{"name":"Albania","flag":"ðŸ‡¦ðŸ‡±","code":"AL"},{"name":"Algeria","flag":"ðŸ‡©ðŸ‡¿","code":"DZ"},{"name":"Andorra","flag":"ðŸ‡¦ðŸ‡©","code":"AD"},{"name":"Angola","flag":"ðŸ‡¦ðŸ‡´","code":"AO"},{"name":"Argentina","flag":"ðŸ‡¦ðŸ‡·","code":"AR"},{"name":"Armenia","flag":"ðŸ‡¦ðŸ‡²","code":"AM"},{"name":"Australia","flag":"ðŸ‡¦ðŸ‡º","code":"AU"},{"name":"Austria","flag":"ðŸ‡¦ðŸ‡¹","code":"AT"},{"name":"Azerbaijan","flag":"ðŸ‡¦ðŸ‡¿","code":"AZ"},{"name":"Bahamas","flag":"ðŸ‡§ðŸ‡¸","code":"BS"},{"name":"Bahrain","flag":"ðŸ‡§ðŸ‡­","code":"BH"},{"name":"Bangladesh","flag":"ðŸ‡§ðŸ‡©","code":"BD"},{"name":"Barbados","flag":"ðŸ‡§ðŸ‡§","code":"BB"},{"name":"Belarus","flag":"ðŸ‡§ðŸ‡¾","code":"BY"},{"name":"Belgium","flag":"ðŸ‡§ðŸ‡ª","code":"BE"},{"name":"Belize","flag":"ðŸ‡§ðŸ‡¿","code":"BZ"},{"name":"Benin","flag":"ðŸ‡§ðŸ‡¯","code":"BJ"},{"name":"Bhutan","flag":"ðŸ‡§ðŸ‡¹","code":"BT"},{"name":"Bolivia","flag":"ðŸ‡§ðŸ‡´","code":"BO"},{"name":"Bosnia and Herzegovina","flag":"ðŸ‡§ðŸ‡¦","code":"BA"},{"name":"Botswana","flag":"ðŸ‡§ðŸ‡¼","code":"BW"},{"name":"Brazil","flag":"ðŸ‡§ðŸ‡·","code":"BR"},{"name":"Brunei","flag":"ðŸ‡§ðŸ‡³","code":"BN"},{"name":"Bulgaria","flag":"ðŸ‡§ðŸ‡¬","code":"BG"},{"name":"Burkina Faso","flag":"ðŸ‡§ðŸ‡«","code":"BF"},{"name":"Burundi","flag":"ðŸ‡§ðŸ‡®","code":"BI"},{"name":"Cambodia","flag":"ðŸ‡°ðŸ‡­","code":"KH"},{"name":"Cameroon","flag":"ðŸ‡¨ðŸ‡²","code":"CM"},{"name":"Canada","flag":"ðŸ‡¨ðŸ‡¦","code":"CA"},{"name":"Cape Verde","flag":"ðŸ‡¨ðŸ‡»","code":"CV"},{"name":"Chad","flag":"ðŸ‡¹ðŸ‡©","code":"TD"},{"name":"Chile","flag":"ðŸ‡¨ðŸ‡±","code":"CL"},{"name":"China","flag":"ðŸ‡¨ðŸ‡³","code":"CN"},{"name":"Colombia","flag":"ðŸ‡¨ðŸ‡´","code":"CO"},{"name":"Comoros","flag":"ðŸ‡°ðŸ‡²","code":"KM"},{"name":"Congo (Dem. Rep.)","flag":"ðŸ‡¨ðŸ‡©","code":"CD"},{"name":"Congo (Rep.)","flag":"ðŸ‡¨ðŸ‡¬","code":"CG"},{"name":"Costa Rica","flag":"ðŸ‡¨ðŸ‡·","code":"CR"},{"name":"Croatia","flag":"ðŸ‡­ðŸ‡·","code":"HR"},{"name":"Cuba","flag":"ðŸ‡¨ðŸ‡º","code":"CU"},{"name":"Cyprus","flag":"ðŸ‡¨ðŸ‡¾","code":"CY"},{"name":"Czechia","flag":"ðŸ‡¨ðŸ‡¿","code":"CZ"},{"name":"Denmark","flag":"ðŸ‡©ðŸ‡°","code":"DK"},{"name":"Djibouti","flag":"ðŸ‡©ðŸ‡¯","code":"DJ"},{"name":"Dominica","flag":"ðŸ‡©ðŸ‡²","code":"DM"},{"name":"Dominican Republic","flag":"ðŸ‡©ðŸ‡´","code":"DO"},{"name":"Ecuador","flag":"ðŸ‡ªðŸ‡¨","code":"EC"},{"name":"Egypt","flag":"ðŸ‡ªðŸ‡¬","code":"EG"},{"name":"El Salvador","flag":"ðŸ‡¸ðŸ‡»","code":"SV"},{"name":"Estonia","flag":"ðŸ‡ªðŸ‡ª","code":"EE"},{"name":"Ethiopia","flag":"ðŸ‡ªðŸ‡¹","code":"ET"},{"name":"Fiji","flag":"ðŸ‡«ðŸ‡¯","code":"FJ"},{"name":"Finland","flag":"ðŸ‡«ðŸ‡®","code":"FI"},{"name":"France","flag":"ðŸ‡«ðŸ‡·","code":"FR"},{"name":"Gabon","flag":"ðŸ‡¬ðŸ‡¦","code":"GA"},{"name":"Gambia","flag":"ðŸ‡¬ðŸ‡²","code":"GM"},{"name":"Georgia","flag":"ðŸ‡¬ðŸ‡ª","code":"GE"},{"name":"Germany","flag":"ðŸ‡©ðŸ‡ª","code":"DE"},{"name":"Ghana","flag":"ðŸ‡¬ðŸ‡­","code":"GH"},{"name":"Greece","flag":"ðŸ‡¬ðŸ‡·","code":"GR"},{"name":"Grenada","flag":"ðŸ‡¬ðŸ‡©","code":"GD"},{"name":"Guatemala","flag":"ðŸ‡¬ðŸ‡¹","code":"GT"},{"name":"Guinea","flag":"ðŸ‡¬ðŸ‡³","code":"GN"},{"name":"Guyana","flag":"ðŸ‡¬ðŸ‡¾","code":"GY"},{"name":"Haiti","flag":"ðŸ‡­ðŸ‡¹","code":"HT"},{"name":"Honduras","flag":"ðŸ‡­ðŸ‡³","code":"HN"},{"name":"Hungary","flag":"ðŸ‡­ðŸ‡º","code":"HU"},{"name":"Iceland","flag":"ðŸ‡®ðŸ‡¸","code":"IS"},{"name":"India","flag":"ðŸ‡®ðŸ‡³","code":"IN"},{"name":"Indonesia","flag":"ðŸ‡®ðŸ‡©","code":"ID"},{"name":"Iran","flag":"ðŸ‡®ðŸ‡·","code":"IR"},{"name":"Iraq","flag":"ðŸ‡®ðŸ‡¶","code":"IQ"},{"name":"Ireland","flag":"ðŸ‡®ðŸ‡ª","code":"IE"},{"name":"Israel","flag":"ðŸ‡®ðŸ‡±","code":"IL"},{"name":"Italy","flag":"ðŸ‡®ðŸ‡¹","code":"IT"},{"name":"Jamaica","flag":"ðŸ‡¯ðŸ‡²","code":"JM"},{"name":"Japan","flag":"ðŸ‡¯ðŸ‡µ","code":"JP"},{"name":"Jordan","flag":"ðŸ‡¯ðŸ‡´","code":"JO"},{"name":"Kazakhstan","flag":"ðŸ‡°ðŸ‡¿","code":"KZ"},{"name":"Kenya","flag":"ðŸ‡°ðŸ‡ª","code":"KE"},{"name":"Kiribati","flag":"ðŸ‡°ðŸ‡®","code":"KI"},{"name":"Kuwait","flag":"ðŸ‡°ðŸ‡¼","code":"KW"},{"name":"Kyrgyzstan","flag":"ðŸ‡°ðŸ‡¬","code":"KG"},{"name":"Laos","flag":"ðŸ‡±ðŸ‡¦","code":"LA"},{"name":"Latvia","flag":"ðŸ‡±ðŸ‡»","code":"LV"},{"name":"Lebanon","flag":"ðŸ‡±ðŸ‡§","code":"LB"},{"name":"Lesotho","flag":"ðŸ‡±ðŸ‡¸","code":"LS"},{"name":"Liberia","flag":"ðŸ‡±ðŸ‡·","code":"LR"},{"name":"Libya","flag":"ðŸ‡±ðŸ‡¾","code":"LY"},{"name":"Liechtenstein","flag":"ðŸ‡±ðŸ‡®","code":"LI"},{"name":"Lithuania","flag":"ðŸ‡±ðŸ‡¹","code":"LT"},{"name":"Luxembourg","flag":"ðŸ‡±ðŸ‡º","code":"LU"},{"name":"Madagascar","flag":"ðŸ‡²ðŸ‡¬","code":"MG"},{"name":"Malawi","flag":"ðŸ‡²ðŸ‡¼","code":"MW"},{"name":"Malaysia","flag":"ðŸ‡²ðŸ‡¾","code":"MY"},{"name":"Maldives","flag":"ðŸ‡²ðŸ‡»","code":"MV"},{"name":"Mali","flag":"ðŸ‡²ðŸ‡±","code":"ML"},{"name":"Malta","flag":"ðŸ‡²ðŸ‡¹","code":"MT"},{"name":"Mexico","flag":"ðŸ‡²ðŸ‡½","code":"MX"},{"name":"Monaco","flag":"ðŸ‡²ðŸ‡¨","code":"MC"},{"name":"Mongolia","flag":"ðŸ‡²ðŸ‡³","code":"MN"},{"name":"Montenegro","flag":"ðŸ‡²ðŸ‡ª","code":"ME"},{"name":"Morocco","flag":"ðŸ‡²ðŸ‡¦","code":"MA"},{"name":"Mozambique","flag":"ðŸ‡²ðŸ‡¿","code":"MZ"},{"name":"Myanmar","flag":"ðŸ‡²ðŸ‡²","code":"MM"},{"name":"Namibia","flag":"ðŸ‡³ðŸ‡¦","code":"NA"},{"name":"Nauru","flag":"ðŸ‡³ðŸ‡·","code":"NR"},{"name":"Nepal","flag":"ðŸ‡³ðŸ‡µ","code":"NP"},{"name":"Netherlands","flag":"ðŸ‡³ðŸ‡±","code":"NL"},{"name":"New Zealand","flag":"ðŸ‡³ðŸ‡¿","code":"NZ"},{"name":"Nicaragua","flag":"ðŸ‡³ðŸ‡®","code":"NI"},{"name":"Niger","flag":"ðŸ‡³ðŸ‡ª","code":"NE"},{"name":"Nigeria","flag":"ðŸ‡³ðŸ‡¬","code":"NG"},{"name":"North Korea","flag":"ðŸ‡°ðŸ‡µ","code":"KP"},{"name":"North Macedonia","flag":"ðŸ‡²ðŸ‡°","code":"MK"},{"name":"Norway","flag":"ðŸ‡³ðŸ‡´","code":"NO"},{"name":"Oman","flag":"ðŸ‡´ðŸ‡²","code":"OM"},{"name":"Pakistan","flag":"ðŸ‡µðŸ‡°","code":"PK"},{"name":"Palau","flag":"ðŸ‡µðŸ‡¼","code":"PW"},{"name":"Palestine","flag":"ðŸ‡µðŸ‡¸","code":"PS"},{"name":"Panama","flag":"ðŸ‡µðŸ‡¦","code":"PA"},{"name":"Paraguay","flag":"ðŸ‡µðŸ‡¾","code":"PY"},{"name":"Peru","flag":"ðŸ‡µðŸ‡ª","code":"PE"},{"name":"Philippines","flag":"ðŸ‡µðŸ‡­","code":"PH"},{"name":"Poland","flag":"ðŸ‡µðŸ‡±","code":"PL"},{"name":"Portugal","flag":"ðŸ‡µðŸ‡¹","code":"PT"},{"name":"Qatar","flag":"ðŸ‡¶ðŸ‡¦","code":"QA"},{"name":"Romania","flag":"ðŸ‡·ðŸ‡´","code":"RO"},{"name":"Russia","flag":"ðŸ‡·ðŸ‡º","code":"RU"},{"name":"Rwanda","flag":"ðŸ‡·ðŸ‡¼","code":"RW"},{"name":"Saint Lucia","flag":"ðŸ‡±ðŸ‡¨","code":"LC"},{"name":"San Marino","flag":"ðŸ‡¸ðŸ‡²","code":"SM"},{"name":"Saudi Arabia","flag":"ðŸ‡¸ðŸ‡¦","code":"SA"},{"name":"Senegal","flag":"ðŸ‡¸ðŸ‡³","code":"SN"},{"name":"Serbia","flag":"ðŸ‡·ðŸ‡¸","code":"RS"},{"name":"Seychelles","flag":"ðŸ‡¸ðŸ‡¨","code":"SC"},{"name":"Singapore","flag":"ðŸ‡¸ðŸ‡¬","code":"SG"},{"name":"Slovakia","flag":"ðŸ‡¸ðŸ‡°","code":"SK"},{"name":"Slovenia","flag":"ðŸ‡¸ðŸ‡®","code":"SI"},{"name":"South Africa","flag":"ðŸ‡¿ðŸ‡¦","code":"ZA"},{"name":"South Korea","flag":"ðŸ‡°ðŸ‡·","code":"KR"},{"name":"Spain","flag":"ðŸ‡ªðŸ‡¸","code":"ES"},{"name":"Sweden","flag":"ðŸ‡¸ðŸ‡ª","code":"SE"},{"name":"Switzerland","flag":"ðŸ‡¨ðŸ‡­","code":"CH"},{"name":"Syria","flag":"ðŸ‡¸ðŸ‡¾","code":"SY"},{"name":"Taiwan","flag":"ðŸ‡¹ðŸ‡¼","code":"TW"},{"name":"Tajikistan","flag":"ðŸ‡¹ðŸ‡¯","code":"TJ"},{"name":"Tanzania","flag":"ðŸ‡¹ðŸ‡¿","code":"TZ"},{"name":"Thailand","flag":"ðŸ‡¹ðŸ‡­","code":"TH"},{"name":"Togo","flag":"ðŸ‡¹ðŸ‡¬","code":"TG"},{"name":"Tonga","flag":"ðŸ‡¹ðŸ‡´","code":"TO"},{"name":"Tunisia","flag":"ðŸ‡¹ðŸ‡³","code":"TN"},{"name":"Turkey","flag":"ðŸ‡¹ðŸ‡·","code":"TR"},{"name":"Turkmenistan","flag":"ðŸ‡¹ðŸ‡²","code":"TM"},{"name":"Uganda","flag":"ðŸ‡ºðŸ‡¬","code":"UG"},{"name":"Ukraine","flag":"ðŸ‡ºðŸ‡¦","code":"UA"},{"name":"United Arab Emirates","flag":"ðŸ‡¦ðŸ‡ª","code":"AE"},{"name":"United Kingdom","flag":"ðŸ‡¬ðŸ‡§","code":"GB"},{"name":"United States","flag":"ðŸ‡ºðŸ‡¸","code":"US"},{"name":"Uruguay","flag":"ðŸ‡ºðŸ‡¾","code":"UY"},{"name":"Uzbekistan","flag":"ðŸ‡ºðŸ‡¿","code":"UZ"},{"name":"Vatican City","flag":"ðŸ‡»ðŸ‡¦","code":"VA"},{"name":"Venezuela","flag":"ðŸ‡»ðŸ‡ª","code":"VE"},{"name":"Vietnam","flag":"ðŸ‡»ðŸ‡³","code":"VN"},{"name":"Yemen","flag":"ðŸ‡¾ðŸ‡ª","code":"YE"},{"name":"Zambia","flag":"ðŸ‡¿ðŸ‡²","code":"ZM"},{"name":"Zimbabwe","flag":"ðŸ‡¿ðŸ‡¼","code":"ZW"}].sort((a,b)=>a.name.localeCompare(b.name));

        tg.CloudStorage.getItem('profile', (err, savedProfile) => {
            if (savedProfile) {
                window.location.href = '/chat';
                return;
            }

            document.getElementById('app').innerHTML = `
                <div class="header">
                    <div class="logo"><span class="logo-emoji">ðŸ”€</span> Chatle</div>
                    <p class="subtitle">Instant anonymous chats with strangers worldwide</p>
                </div>

                <div class="profile-card">
                    <img src="${photoUrl}" alt="Profile" class="avatar">
                    <h2 class="greeting">Hello, ${displayName}</h2>
                    <p class="info">Complete your profile to start chatting</p>
                </div>

                <div class="form-group">
                    <label>Nickname <span class="required">(required)</span></label>
                    <input type="text" id="nickname" placeholder="Choose your nickname" autocomplete="off">
                </div>

                <div class="form-group">
                    <label>Age <span class="required">(required)</span></label>
                    <input type="number" id="age" placeholder="Your age" min="13" max="99">
                </div>

                <div class="form-group">
                    <label>Gender <span class="required">(required)</span></label>
                    <select id="gender">
                        <option value="" disabled selected>Select gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other / Prefer not to say</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Country <span class="required">(required)</span></label>
                    <div class="country-input">
                        <input type="text" id="country-search" placeholder="Search or select your country" autocomplete="off">
                        <div id="country-list"></div>
                    </div>
                    <input type="hidden" id="selected-country">
                </div>

                <div class="form-group">
                    <label>Bio <span style="opacity:0.6">(optional)</span></label>
                    <textarea id="bio" placeholder="Tell something about yourself, hobbies, what you're looking for..."></textarea>
                </div>
            `;

            const countrySearch = document.getElementById('country-search');
            const countryList = document.getElementById('country-list');
            const selectedCountry = document.getElementById('selected-country');

            const showCountries = (query) => {
                countryList.innerHTML = '';
                const filtered = countries.filter(c => 
                    c.name.toLowerCase().includes(query.toLowerCase()) ||
                    c.code.toLowerCase().includes(query.toLowerCase())
                );

                if (filtered.length === 0) {
                    countryList.style.display = 'none';
                    return;
                }

                filtered.forEach(country => {
                    const item = document.createElement('div');
                    item.className = 'country-item';
                    item.textContent = `\( {country.flag} \){country.name}`;
                    item.onclick = () => {
                        countrySearch.value = `\( {country.flag} \){country.name}`;
                        selectedCountry.value = country.code;
                        countryList.style.display = 'none';
                    };
                    countryList.appendChild(item);
                });

                countryList.style.display = 'block';
            };

            countrySearch.addEventListener('focus', () => showCountries(''));
            countrySearch.addEventListener('input', e => showCountries(e.target.value));

            document.addEventListener('click', e => {
                if (!countrySearch.contains(e.target) && !countryList.contains(e.target)) {
                    countryList.style.display = 'none';
                }
            });

            tg.MainButton.setText("Start Chatting â†’");
            tg.MainButton.color = '#0088cc';
            tg.MainButton.show();
            tg.MainButton.enable();

            tg.MainButton.onClick(() => {
                const nickname = document.getElementById('nickname').value.trim();
                const age = document.getElementById('age').value;
                const gender = document.getElementById('gender').value;
                const countryCode = selectedCountry.value;

                if (!nickname || !age || !gender || !countryCode) {
                    tg.showAlert("Please fill in all required fields.");
                    return;
                }

                if (age < 13 || age > 99) {
                    tg.showAlert("Age must be between 13 and 99.");
                    return;
                }

                const profile = {
                    nickname,
                    age: parseInt(age),
                    gender,
                    country: countryCode,
                    countryDisplay: countrySearch.value,
                    bio: document.getElementById('bio').value.trim(),
                    telegramId: user.id,
                    username: user.username || null,
                    firstName: user.first_name,
                    lastName: user.last_name || null,
                    photoUrl: user.photo_url || null,
                    savedAt: new Date().toISOString()
                };

                tg.MainButton.showProgress(true);

                tg.CloudStorage.setItem('profile', JSON.stringify(profile), (err, success) => {
                    if (success) {
                        window.location.href = '/chat';
                    } else {
                        tg.MainButton.hideProgress();
                        tg.showAlert("Save failed. Try again.");
                    }
                });
            });
        });
    </script>
</body>
</html>                        
